{% extends 'ClarolineCoreBundle:Workspace:base_template.html.twig' %}
{% block section_content %}
{{ 'registered_users'|trans({}, 'platformTranslation') }}
{{workspace.getName()}}

<input type="button" id="button_user" value="{{ 'add_user'|trans({}, 'platformTranslation') }}" ></input>
<ul id="workspace_users">
    {% for user in users %}
        <li class="row_user" id="user_{{user.getId()}}" >
            {{user.getUsername()}}
            <a href="{{path('claro_workspace_delete_user_workspace', {'userId':user.getId(), 'workspaceId':workspace.getId() })}}" id="link_delete_{{user.getId()}}">delete</a>
        </li>    
    {% endfor %}
</ul>

<!----------- user list window ------------------------------------------------->
 <div id="list_user_window" title="user_list">
		<div id="list_user_window_handle">			
			{{ 'list_users'|trans({}, 'platformTranslation') }}
            <a href="#" id="close">[x]</a>
		</div>
        <div id="list_user_window_content">
            <form id="list_user_form" >
                <div id="checkboxes" style="overflow-y:scroll;"></div></br>
                <input type="button" id="add_next" value="add next"> 
            </form>
        </div>
        <div class="loading">load...</div>   
</div>
<!----------- end list --------------------------------------------------------->
<script language="Javascript" src="{{ asset('bundles/clarolinecore/js/jquery/ui/jquery.ui.sortable.js') }}" ></script>
<script language="Javascript" src="{{ asset('bundles/clarolinecore/js/jquery/ui/jquery.ui.core.js') }}" ></script>
<script language="Javascript" src="{{ asset('bundles/clarolinecore/js/jquery/ui/jquery.ui.widget.js') }}" ></script>
<script language="Javascript" src="{{ asset('bundles/clarolinecore/js/jquery/ui/jquery.ui.mouse.js') }}" ></script>
<script language="Javascript" src="{{ asset('bundles/clarolinecore/js/jquery/ui/jquery.ui.draggable.js') }}" ></script>
<script language="Javascript">
    
var nbIteration=0;   
    
$(document).ready(function() 
{ 
    $(".loading").hide();
    $("#list_user_window").draggable();		
    $("#list_user_window").hide();
    
    $('#button_user').click(function()
	{
		$("#list_user_window").show();
	});
    
    $('#close').click(function()
	{
		$("#list_user_window").hide();
	});
    
    $('#checkboxes').on("click", ".checkbox_user", function(event){
        var userId = $(this).val();
        if($(this).is(':checked')) 
        {
            setOnAddChkBox(userId);
        }
        else
        {
            setOnRemoveChkBox(userId);  
        }
    });   
});    

$("#add_next").click(function(){
    $(".loading").show();
    $.ajax({
        type: "POST",
        url: Routing.generate('claro_workspace_ajax_get_add_user_workspace', { "id":{{workspace.getId()}}, "nbIteration":nbIteration}),
        cache: false,
        dataType: 'html',
        success: function(data){
            nbIteration++;
            $('#checkboxes').append(data);
            $(".loading").hide(); 
        }, 
        error: function(xhr) {
            alert(xhr.status);
        }
      });    
});

function setOnAddChkBox(userId)
{
     $.ajax({
         type:"POST",
         url: Routing.generate('claro_workspace_ajax_add_user_workspace', {"userId":userId, "workspaceId" : {{workspace.getId()}}}),
         cache: false,
         dataType: 'html',
         success: function(data){
             $('#workspace_users').append(data);
         },
         error: function(xhr){
                 alert(xhr.status);
             }
      });
}

function setOnRemoveChkBox(userId)
{
    $.ajax({
        type:"POST",
        url: Routing.generate('claro_workspace_ajax_delete_user_workspace', {"userId":userId, "workspaceId" : {{workspace.getId()}}}),
        cache: false,
        dataType: 'html',
        success: function(data){
            $("#user_"+userId).remove();
            },
        error: function(xhr){
            alert(xhr.status);
            }
    });       
}    
</script>
{% endblock %}