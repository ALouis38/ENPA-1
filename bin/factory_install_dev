<?php

/*
 * This script can be used to make a fresh install of Claronext
 * for a developper. It will initialize dev and test environments
 *
 * Requirements :
 *    - a valid 'app/config/local/parameters.yml' file
 *    - a writable app/config/local directory
 *    - an empty, writable app/cache directory
 *    - an empty, writable app/logs directory
 */

$rootDirectory = realpath(__DIR__ . "/..");

function deleteIfExists($file)
{
    if(file_exists($file))
    {
        unlink($file);
    }
}

deleteIfExists("{$rootDirectory}/app/config/plugin/bundles");
deleteIfExists("{$rootDirectory}/app/config/plugin/namespaces");
deleteIfExists("{$rootDirectory}/app/config/plugin/routing.yml");

system("php {$rootDirectory}/bin/vendors install");

system("php {$rootDirectory}/app/console doctrine:database:drop --force --env=dev");
system("php {$rootDirectory}/app/console doctrine:database:create --env=dev");
system("php {$rootDirectory}/app/console cache:clear --no-warmup --env=dev");
system("php {$rootDirectory}/app/console claroline:install --with-plugins --with-prod-fixtures --env=dev");

system("php {$rootDirectory}/app/console doctrine:database:drop --force --env=test");
system("php {$rootDirectory}/app/console doctrine:database:create --env=test");
system("php {$rootDirectory}/app/console cache:clear --no-warmup --env=test");
system("php {$rootDirectory}/app/console claroline:install --with-plugins --env=test");
system("php {$rootDirectory}/app/console claroline:files:clean");
