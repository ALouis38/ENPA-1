<?php

/*
 * This script can be used as a part of a CIS job.
 *
 * Requirements :
 * - CIS cloned repository must contain a valid 'app/config/parameters.ini' file,
 *   with correct database settings.
 * - 'app/cache' and 'app/logs' directories must be writable.
 */

$rootDirectory = realpath(__DIR__ . "/..");

system("php {$rootDirectory}/bin/vendors install");

system("php {$rootDirectory}/app/console doctrine:database:drop --force");
system("php {$rootDirectory}/app/console doctrine:database:drop --force --env=test");
system("php {$rootDirectory}/app/console doctrine:database:create");
system("php {$rootDirectory}/app/console doctrine:database:create --env=test");
system("php {$rootDirectory}/app/console doctrine:schema:create");
system("php {$rootDirectory}/app/console doctrine:schema:create --env=test");
system("php {$rootDirectory}/app/console init:acl");
system("php {$rootDirectory}/app/console init:acl --env=test");
system("php {$rootDirectory}/app/console claroline:plugin:install_all");
system("php {$rootDirectory}/app/console claroline:plugin:install_all --env=test");

system("phpunit -c {$rootDirectory}/app");